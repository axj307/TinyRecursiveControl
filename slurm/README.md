# SLURM Scripts for TinyRecursiveControl Paper

This directory contains all SLURM batch scripts for reproducing the paper results.

## Overview

The paper compares **Behavior Cloning (BC)** vs **Process Supervision (PS)** on two control problems:
- Double Integrator (2D linear system)
- Van der Pol (2D nonlinear oscillator)

All experiments use **seed=42** for fair comparison between methods.

---

## Main Experiments (Phase 4)

These are the core results comparing BC vs PS:

### Double Integrator
```bash
sbatch slurm/phase4_di_bc.sbatch   # BC baseline
sbatch slurm/phase4_di_ps.sbatch   # PS method
```

### Van der Pol
```bash
sbatch slurm/phase4_vdp_bc.sbatch  # BC baseline
sbatch slurm/phase4_vdp_ps.sbatch  # PS method
```

### Run All + Comparison
```bash
bash slurm/launch_phase4.sh        # Launches all 4 + comparison
```

**Output**: `outputs/phase4/{problem}_{method}_{jobid}_{timestamp}/`

---

## Robustness Study (Multi-Seed)

Tests stability across 5 random seeds (42, 123, 456, 789, 1011) on Van der Pol:

```bash
# Run BC with 5 seeds (parallel)
sbatch slurm/robustness_vdp_bc_multiseed.sbatch

# Run PS with 5 seeds (parallel)
sbatch slurm/robustness_vdp_ps_multiseed.sbatch
```

**Output**: `outputs/robustness/vanderpol_{bc|ps}_seed{SEED}_{jobid}_{timestamp}/`

**Analysis**:
```bash
python scripts/aggregate_robustness_results.py
```

Generates `outputs/robustness/robustness_summary.md` with mean ± std tables.

---

## Lambda (λ) Ablation Study

Tests process weight λ ∈ {0.0, 0.01, 0.1, 0.5, 1.0} on Van der Pol PS:

```bash
sbatch slurm/ablation_lambda.sbatch
```

**Output**: `outputs/ablation_lambda/vanderpol_ps_lambda{LAMBDA}_{jobid}_{timestamp}/`

**Analysis**:
```bash
python scripts/analyze_lambda_ablation.py
```

Generates plots and tables showing optimal λ value.

---

## Run All Paper Experiments

```bash
bash slurm/run_all_paper_experiments.sh
```

This launches:
1. Phase 4 main experiments (4 jobs)
2. Robustness study (10 jobs)
3. Lambda ablation (5 jobs)
4. Comparison analysis (1 job, waits for all above)

**Total**: 20 jobs, ~3-4 hours wall time (parallel execution)

---

## Monitoring Jobs

```bash
# View all your jobs
squeue -u $USER

# View specific job
squeue -j <JOB_ID>

# View log (live)
tail -f slurm_logs/phase4_di_bc_<JOB_ID>.out

# Cancel all jobs
scancel -u $USER
```

---

## Output Directory Structure

```
outputs/
├── phase4/                    # Main BC vs PS comparison
│   ├── double_integrator_bc_*/
│   ├── double_integrator_ps_*/
│   ├── vanderpol_bc_*/
│   ├── vanderpol_ps_*/
│   └── comparison/            # Comparison analysis
│       ├── phase4_comparison_report.md
│       └── figures/
├── robustness/                # Multi-seed study
│   ├── vanderpol_bc_seed42_*/
│   ├── vanderpol_bc_seed123_*/
│   ├── ... (10 total)
│   └── robustness_summary.md  # Generated by aggregation script
└── ablation_lambda/           # Lambda sweep
    ├── vanderpol_ps_lambda0.0_*/
    ├── vanderpol_ps_lambda0.01_*/
    ├── ... (5 total)
    └── lambda_analysis/       # Generated by analysis script
        ├── lambda_sweep.png
        └── lambda_table.md
```

---

## Scripts Listing

### Main Experiments
- `phase4_di_bc.sbatch` - Double Integrator BC
- `phase4_di_ps.sbatch` - Double Integrator PS
- `phase4_vdp_bc.sbatch` - Van der Pol BC
- `phase4_vdp_ps.sbatch` - Van der Pol PS
- `phase4_comparison.sbatch` - Generate comparison report
- `launch_phase4.sh` - Launch all Phase 4 experiments

### Ablation Studies
- `robustness_vdp_bc_multiseed.sbatch` - Multi-seed BC study
- `robustness_vdp_ps_multiseed.sbatch` - Multi-seed PS study
- `ablation_lambda.sbatch` - Process weight sweep

### Master Scripts
- `run_all_paper_experiments.sh` - Run ALL experiments for paper
- `README.md` - This file

### Archived Scripts
- `archive/` - Old/redundant scripts not used for paper

---

## Paper Reproduction

To fully reproduce paper results from scratch:

```bash
# 1. Run all experiments (~3-4 hours)
bash slurm/run_all_paper_experiments.sh

# 2. Wait for all jobs to complete
watch -n 10 squeue -u $USER

# 3. Generate paper tables
python scripts/generate_paper_tables.py

# 4. Check results
cat docs/PAPER_RESULTS.md
```

---

## Key Parameters

All experiments use identical hyperparameters:
- **Model**: `two_level_medium` (398K parameters)
- **Epochs**: 50
- **Batch size**: 32
- **Learning rate**: 1e-3
- **Random seed**: 42 (main) or 42,123,456,789,1011 (robustness)
- **Process weight (λ)**: 0.1 (main PS experiments)

---

## Notes

- All scripts use the `pi_linaresr` partition
- Each job requests 1 GPU, 8 CPUs, 64GB RAM
- Typical runtime: 1-2 hours per job
- SLURM logs: `slurm_logs/`
- Failed jobs: Check `.err` logs

---

## Contact

For issues or questions, check:
- Main README: `/orcd/home/002/amitjain/project/TinyRecursiveControl/README.md`
- Merge tracking: `MERGE_TRACKING.md`
- Phase 4 guide: `slurm/README_PHASE4.md`
